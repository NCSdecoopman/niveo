---
import '../styles/global.css';
import DataTable from '../components/DataTable.astro';
import SnowMap from '../components/SnowMap.astro';

// Base robuste: '/niveo/' en prod, '/' en dev
const b = import.meta.env.BASE_URL || '/';
const base = b.endsWith('/') ? b : b + '/';

const obsUrl = `${base}data/observations.json`;
const staUrl = `${base}data/metadonnees/stations.json`;
---
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>niveo — Visualisation neigeuse</title>
    <meta name="color-scheme" content="dark light" />
  </head>
  <body>
    <header class="container page-header flex items-center gap-3">
      <h1 class="sr-only">niveo</h1>
        <img
          src={`${base}logo/niveo-black.svg`}
          alt="niveo"
          width="128"
          height="44"
          loading="eager"
          decoding="async"
        />
    </header>

    <main class="container grid">
      <section class="card">
        <h2 class="sr-only">Tableau</h2>
        <DataTable obsUrl={obsUrl} staUrl={staUrl} />
      </section>

      <section class="card h-[600px] flex flex-col">
        <h2 class="sr-only">Carte</h2>
        <SnowMap obsUrl={obsUrl} staUrl={staUrl} />
      </section>
    </main>

    <footer class="site-footer" role="contentinfo" aria-label="Pied de page et citation des données">
      <div class="container">
        <p class="citation">
          <span class="label">Source&nbsp;:</span>
          <cite>
            Météo-France. (2025).
            <em>Données Publiques — API Données de climatologie (DPClim v1)</em>.
            Portail API Météo-France. Consulté le <time datetime="2025-11-08">2025-11-08</time>,
            depuis <a href="https://meteo.data.gouv.fr" rel="noopener noreferrer">meteo.data.gouv.fr</a>.
          </cite>
        </p>
        <p class="meta">
          <a href="https://www.etalab.gouv.fr/licence-ouverte-open-licence" rel="license noopener noreferrer">Licence Ouverte v2.0</a>
          <span aria-hidden="true">•</span>
          <a href="https://public-api.meteofrance.fr/public/DPClim/v1" rel="noopener noreferrer">API DPClim v1</a>
          <span aria-hidden="true">•</span>
          <span>© 2025</span>
        </p>
      </div>
    </footer>

  </body>
</html>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2YTSV4PT9X"></script>
<script is:inline>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2YTSV4PT9X', { 'anonymize_ip': true });
</script>